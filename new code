import os
import pandas as pd
from azure.ai.documentintelligence import DocumentIntelligenceClient
from azure.core.credentials import AzureKeyCredential

# --------- CONFIG ----------
endpoint = "<YOUR_ENDPOINT>"   # e.g. "https://<your-resource-name>.cognitiveservices.azure.com/"
key = "<YOUR_KEY>"
pdf_path = "sample.pdf"        # local PDF file
# ----------------------------

# Initialize client
client = DocumentIntelligenceClient(endpoint=endpoint, credential=AzureKeyCredential(key))

# Open PDF
with open(pdf_path, "rb") as f:
    poller = client.begin_analyze_document(
        model_id="prebuilt-read",   # OCR/read model
        analyze_request=f,
        content_type="application/pdf"
    )

result = poller.result()

# Collect page-wise text
rows = []
for page in result.pages:
    page_num = page.page_number
    # Collect all lines for this page
    text_lines = []
    for line in result.paragraphs:
        if line.bounding_regions and line.bounding_regions[0].page_number == page_num:
            text_lines.append(line.content)
    page_text = "\n".join(text_lines)
    
    rows.append({"page_num": page_num, "ocr_text": page_text})

# Create DataFrame
df = pd.DataFrame(rows)
print(df.head())

# Save if needed
df.to_csv("pdf_ocr_output.csv", index=False)